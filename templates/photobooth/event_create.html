{% extends "_base.html" %}

{% block title %}Create Event - Photobooth{% endblock title %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>Create New Event</h3>
            </div>
            <div class="card-body">
                <form id="createEventForm">
                    <div id="error-messages" class="alert alert-danger d-none"></div>
                    <div id="success-messages" class="alert alert-success d-none"></div>
                    
                    <div class="mb-3">
                        <label for="eventName" class="form-label">Event Name</label>
                        <input type="text" 
                               id="eventName" 
                               name="name" 
                               class="form-control" 
                               placeholder="e.g., John & Jane Wedding"
                               required>
                        <div class="form-text">Give your event a memorable name</div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> A unique 6-character code will be automatically generated for your event. Share this code with your guests so they can join and take photos!
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'photobooth:event_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Events
                        </a>
                        <button type="submit" class="btn btn-primary" id="createButton">
                            <i class="fas fa-plus"></i> Create Event
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('createEventForm');
    const errorDiv = document.getElementById('error-messages');
    const successDiv = document.getElementById('success-messages');
    const createButton = document.getElementById('createButton');
    
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const name = document.getElementById('eventName').value.trim();
        
        if (!name) {
            showError('Please enter an event name');
            return;
        }
        
        try {
            createButton.disabled = true;
            createButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            
            const response = await fetch('/api/photobooth/events/create/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ name: name })
            });
            
            const data = await response.json();
            
            if (response.ok) {
                showSuccess(`Event "${data.name}" created successfully! Code: ${data.code}`);
                setTimeout(() => {
                    window.location.href = '{% url "photobooth:event_list" %}';
                }, 2000);
            } else {
                const errorMsg = data.name ? data.name[0] : (data.error || 'Failed to create event');
                showError(errorMsg);
            }
        } catch (error) {
            showError('Network error. Please try again.');
        } finally {
            createButton.disabled = false;
            createButton.innerHTML = '<i class="fas fa-plus"></i> Create Event';
        }
    });
    
    function showError(message) {
        errorDiv.textContent = message;
        errorDiv.classList.remove('d-none');
        successDiv.classList.add('d-none');
    }
    
    function showSuccess(message) {
        successDiv.textContent = message;
        successDiv.classList.remove('d-none');
        errorDiv.classList.add('d-none');
    }
});
</script>
{% endblock content %}
